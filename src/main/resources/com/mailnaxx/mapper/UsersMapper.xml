<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mailnaxx.mapper.UsersMapper">

    <select id="findLoginUser" resultType="com.mailnaxx.entity.Users">
        SELECT
           user_number,
           user_name,
           role_class,
           password,
           last_login_date
        FROM
           users
        WHERE
           user_number = #{userNumber}
    </select>

    <update id="update">
        UPDATE users SET
            last_login_date = CURRENT_TIMESTAMP
            <!-- 認証エラー回数 -->
        WHERE user_number = #{user_number}
    </update>

    <select id="findAll" resultType="com.mailnaxx.entity.Users">
        SELECT * FROM users
        WHERE deleted_flg = '0'
    </select>

    <select id="findBySearchForm" resultType="com.mailnaxx.entity.Users">
        SELECT * FROM users
        WHERE deleted_flg = '0'
        <if test='userName != "" and searchCondition == "0"'>
            AND user_name LIKE #{userName} || '%'
        </if>
        <if test='userName != "" and searchCondition == "1"'>
            AND user_name LIKE '%' || #{userName} || '%'
        </if>
        <if test='roleClass != ""'>
            AND role_class = #{roleClass}
        </if>
    </select>

    <select id="findById" resultType="com.mailnaxx.entity.Users">
        SELECT * FROM users
        WHERE user_id = #{userId}
    </select>

    <select id="findBySales" resultType="com.mailnaxx.entity.Users">
        SELECT * FROM users
        WHERE sales_flg = '1'
        AND deleted_flg = '0'
    </select>

    <insert id="insert" useGeneratedKeys="true" keyProperty="user_id">
        INSERT INTO users
        (
            user_number,
            user_name,
            user_name_kana,
            hire_date,
            affiliation_id,
            role_class,
            sales_flg,
            birth_date,
            post_code,
            address,
            phone_number,
            email_address,
            password,
            created_by,
            created_at
        )
        VALUES
        (
            #{user_number},
            #{user_name},
            #{user_name_kana},
            #{hire_date},
            #{affiliation_id},
            #{role_class},
            #{sales_flg},
            #{birth_date},
            #{post_code},
            #{address},
            #{phone_number},
            #{email_address},
            #{password},
            #{created_by},
            CURRENT_TIMESTAMP
        )
    </insert>

    <!-- 論理削除 -->
    <update id="delete">
        UPDATE users SET
            deleted_flg = '1'
        WHERE user_id = #{userId}
    </update>
</mapper>